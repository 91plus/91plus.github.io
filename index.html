<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ä¸­å›½å¤©åœ°é“¶è¡Œ - ä¸–ç•Œçš„é“¶è¡Œ</title>
  <style>
    /* åŸºç¡€é‡ç½® */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
      background: #f5f6fa;
      line-height: 1.6;
    }
    /* å®¹å™¨æ ·å¼ */
    .container {
      max-width: 100%;
      padding: 20px;
      margin: 0 auto;
    }
    /* ç™»å½•é¡µé¢ */
    .login-container,
    .divine-login-container {
      background: white;
      border-radius: 15px;
      padding: 2rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      max-width: 400px;
      margin: 2rem auto;
      text-align: center;
    }
    .login-header {
      margin-bottom: 2rem;
      color: #2c3e50;
    }
    .button {
      padding: 0.8rem 1.2rem;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      margin: 0.5rem;
    }
    .button-primary { background: #3498db; color: white; }
    .button-success { background: #2ecc71; color: white; }
    .button-danger  { background: #e74c3c; color: white; }
    .button-warning { background: #f39c12; color: white; }
    .button-info    { background: #1abc9c; color: white; }
    /* é’±åŒ…ä¸»ç•Œé¢ */
    .wallet-container {
      background: white;
      border-radius: 15px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      padding: 1.5rem;
      max-width: 800px;
      margin: 1rem auto;
    }
    .header-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .info-text {
      margin-top: 0.5rem;
      font-size: 1.1rem;
      color: #8e44ad;
      text-align: center;
    }
    .balance-card {
      background: linear-gradient(135deg, #3498db, #2980b9);
      color: white;
      padding: 2rem;
      border-radius: 12px;
      margin: 1.5rem 0;
      text-align: center;
    }
    .balance-amount {
      font-size: 2.5rem;
      font-weight: bold;
      margin: 1rem 0;
    }
    /* æŒ‰é’®ç»„ */
    .button-group {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 1rem;
      margin: 1.5rem 0;
    }
    /* äº¤æ˜“è®°å½• */
    #transactions-container {
      margin-top: 1.5rem;
    }
    .transaction-table {
      width: 100%;
      border-collapse: collapse;
      overflow-x: auto;
      display: block;
    }
    .transaction-table th,
    .transaction-table td {
      padding: 1rem;
      text-align: left;
      border-bottom: 1px solid #ecf0f1;
    }
    .transaction-table th {
      background: #f8f9fa;
      color: #2c3e50;
    }
    /* å¼¹å‡ºå±‚ */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal-content {
      background: white;
      padding: 2rem;
      border-radius: 12px;
      width: 90%;
      max-width: 400px;
      position: relative;
    }

    #my-goods-modal .modal-content {
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
    }
    #my-goods-modal .modal-close {
      position: sticky;
      top: 0;
      background: white;
      z-index: 10;
    }
    .modal-close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
    }
    /* è¾“å…¥ç»„ */
    .input-group {
      margin-bottom: 1.5rem;
    }
    .input-label {
      display: block;
      margin-bottom: 0.5rem;
      color: #2c3e50;
    }
    .input-field {
      width: 100%;
      padding: 0.8rem;
      border: 1px solid #bdc3c7;
      border-radius: 8px;
      font-size: 1rem;
      transition: border-color 0.3s ease;
      margin-bottom: 0.5rem;
    }
    .input-field:focus {
      outline: none;
      border-color: #3498db;
    }
    /* åŠ è½½åŠ¨ç”» */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255, 255, 255, 0.8);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 2000;
    }
    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #3498db;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    /* ç¥èŒäººå‘˜åŠŸèƒ½ç•Œé¢ */
    .divine-dashboard {
      background: white;
      border-radius: 15px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      padding: 1.5rem;
      max-width: 800px;
      margin: 1rem auto;
    }
    .divine-section {
      display: none;
      margin-top: 1rem;
    }
    .divine-header {
      font-size: 1.5rem;
      margin-bottom: 1rem;
      text-align: center;
      color: #2c3e50;
    }
    /* é˜ç‹æ¿å—å†…è¡¨å•æ ·å¼ */
    #yanwang-dashboard input.input-field,
    #yanwang-dashboard select.input-field {
      margin-bottom: 0.5rem;
    }
  </style>
</head>
<body>
  <!-- ç”¨æˆ·ç™»å½•é¡µé¢ -->
  <div id="login-page" class="container">
    <div class="login-container">
      <h2 class="login-header">ğŸ” ä¸­å›½å¤©åœ°é“¶è¡Œç™»å½•</h2>
      <div class="input-group">
        <input type="text" class="input-field" id="username" placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å" required>
      </div>
      <div class="input-group">
        <input type="password" class="input-field" id="password" placeholder="è¯·è¾“å…¥æ‚¨çš„å¯†ç " required>
      </div>
      <button class="button button-primary" onclick="login()">ç™»å½•</button>
      <br>
      <button class="button button-info" onclick="document.getElementById('login-page').style.display='none';document.getElementById('divine-login-page').style.display='block';">ç¥èŒäººå‘˜ç™»å½•</button>
    </div>
  </div>

  <!-- é’±åŒ…ä¸»ç•Œé¢ -->
  <div id="wallet-page" class="container" style="display: none;">
    <div class="wallet-container">
      <!-- å¤´éƒ¨ -->
      <div class="header-bar">
        <h2>ğŸ’° ä¸­å›½å¤©åœ°é“¶è¡Œ</h2>
        <button class="button button-danger" onclick="logout()">é€€å‡ºç™»å½•</button>
      </div>
      <div class="info-text">ä¸­å›½å¤©åœ°é“¶è¡Œï¼Œäº¿ä¸‡å¹´ä¿¡èª‰ä¿è¯</div>
       
      <!-- ä½™é¢å¡ç‰‡ -->
      <div class="balance-card">
        <div>å½“å‰ä½™é¢</div>
        <div class="balance-amount" id="balance-amount">$0.00</div>
        <div>äººæ°‘å¸ (CNY)</div>
      </div>
      <!-- æ˜¾ç¤ºåŠŸå¾· -->
      <div class="info-text">åŠŸå¾·ï¼š<span id="merit-value">0</span></div>
 
      <!-- æ“ä½œæŒ‰é’® -->
      <div class="button-group">
        <button class="button button-success" onclick="openModal('recharge-modal')">å……å€¼</button>
        <button class="button button-primary" onclick="openModal('payment-modal')">æ”¯ä»˜</button>
        <button class="button button-primary" onclick="openModal('transfer-modal')">è½¬è´¦</button>
        <button class="button button-warning" onclick="openModal('three-realm-modal')">ä¸‰ç•Œè½¬è´¦</button>
        <button class="button button-danger" onclick="openModal('next-life-modal')">è·¨ä¸–è½¬è´¦</button>
        <button class="button button-primary" onclick="openModal('six-path-modal')">å…­é“è½®å›</button>
        <button class="button button-warning" onclick="openModal('divination-modal')">å¤©å‘½æŠ½ç­¾</button>
        <button class="button button-info" onclick="openModal('talisman-modal')">ç¬¦ç®“è´­ä¹°</button>
        <button class="button button-danger" onclick="openModal('pill-modal')">ä¸¹è¯ç‚¼åˆ¶</button>
        <button class="button button-success" onclick="openModal('offering-modal')">ä¾›ä½›</button>
        <button class="button button-info" onclick="openModal('chanting-modal')">ç»å…¸è¯µç»</button>
        <button class="button button-info" onclick="openModal('my-goods-modal')">æˆ‘çš„å•†å“</button>
      </div>
       
      <!-- äº¤æ˜“è®°å½•æ“ä½œæŒ‰é’® -->
      <div style="display: flex; gap: 1rem; margin-bottom:1rem;">
        <button class="button button-primary" onclick="toggleTransactions()">æŠ˜å /å±•å¼€äº¤æ˜“è®°å½•</button>
        <button class="button button-danger" onclick="clearTransactions()">åˆ é™¤æ‰€æœ‰äº¤æ˜“è®°å½•</button>
      </div>
       
      <!-- äº¤æ˜“è®°å½• -->
      <div id="transactions-container">
        <h3>ğŸ“‹ äº¤æ˜“è®°å½•</h3>
        <table class="transaction-table">
          <thead>
            <tr>
              <th>æ—¶é—´</th>
              <th>ç±»å‹</th>
              <th>é‡‘é¢</th>
              <th>ä½™é¢</th>
              <th>æ“ä½œ</th>
            </tr>
          </thead>
          <tbody id="transaction-body"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- ç¥èŒäººå‘˜ç™»å½•é¡µé¢ -->
  <div id="divine-login-page" class="container" style="display: none;">
    <div class="divine-login-container">
      <h2 class="login-header">ğŸ‘‘ ç¥èŒäººå‘˜ç™»å½•</h2>
      <div class="input-group">
        <label class="input-label" for="divine-role">è¯·é€‰æ‹©ç¥èŒäººå‘˜èº«ä»½</label>
        <select class="input-field" id="divine-role">
          <option value="é…†éƒ½å¤§å¸">é…†éƒ½å¤§å¸</option>
          <option value="é»‘ç™½æ— å¸¸">é»‘ç™½æ— å¸¸</option>
          <option value="å­Ÿå©†">å­Ÿå©†</option>
          <option value="é˜ç‹">é˜ç‹</option>
        </select>
      </div>
      <div class="input-group">
        <input type="password" class="input-field" id="divine-password" placeholder="è¯·è¾“å…¥å¯†ç ">
      </div>
      <button class="button button-primary" onclick="divineLogin()">ç™»å½•</button>
      <br>
      <button class="button button-danger" onclick="document.getElementById('divine-login-page').style.display='none';document.getElementById('login-page').style.display='block';">è¿”å›ç”¨æˆ·ç™»å½•</button>
    </div>
  </div>

  <!-- ç¥èŒäººå‘˜åŠŸèƒ½ç•Œé¢ -->
  <div id="divine-dashboard" class="container divine-dashboard" style="display: none;">
    <div class="header-bar">
      <h2>ğŸ‘‘ ç¥èŒäººå‘˜åŠŸèƒ½ç•Œé¢</h2>
      <button class="button button-danger" onclick="divineLogout()">é€€å‡ºç™»å½•</button>
    </div>
    <!-- é…†éƒ½å¤§å¸ç•Œé¢ -->
    <div id="fengdu-dashboard" class="divine-section">
      <h3 class="divine-header">é…†éƒ½å¤§å¸ - ç”Ÿæ­»ç°¿</h3>
      <button class="button button-primary" onclick="refreshLifeDeathRegister()">åˆ·æ–°ç”Ÿæ­»ç°¿</button>
      <table class="transaction-table">
        <thead>
          <tr>
            <th>åºå·</th>
            <th>å§“å</th>
            <th>çŠ¶æ€</th>
            <th>æ—¶é—´</th>
          </tr>
        </thead>
        <tbody id="life-death-body"></tbody>
      </table>
      <div style="margin-top:1rem;">
        <button class="button button-info" onclick="printLifeDeathRegister()">æ‰“å°ç”Ÿæ­»ç°¿</button>
        <div id="fengdu-stats"></div>
      </div>
    </div>
    <!-- é»‘ç™½æ— å¸¸ç•Œé¢ -->
    <div id="heibai-dashboard" class="divine-section">
      <h3 class="divine-header">é»‘ç™½æ— å¸¸ - ä»»åŠ¡é¢æ¿</h3>
      <button class="button button-primary" onclick="catchPerson()">æŠ“äºº</button>
      <p id="heibai-result" style="margin-top:1rem; font-weight:bold; text-align:center;"></p>
      <div style="margin-top:1rem;">
        <h4>æŠ“æ•å†å²</h4>
        <button class="button button-danger" onclick="clearHeibaiHistory()">æ¸…ç©ºæŠ“æ•å†å²</button>
        <table class="transaction-table">
          <thead>
            <tr>
              <th>åºå·</th>
              <th>å§“å</th>
              <th>æ—¶é—´</th>
              <th>æ“ä½œ</th>
            </tr>
          </thead>
          <tbody id="heibai-history-body"></tbody>
        </table>
      </div>
    </div>
    <!-- å­Ÿå©†ç•Œé¢ -->
    <div id="mengpo-dashboard" class="divine-section">
      <h3 class="divine-header">å­Ÿå©† - å­Ÿå©†æ±¤æœåŠ¡</h3>
      <button class="button button-primary" onclick="serveMengPoSoup()">å€’å­Ÿå©†æ±¤</button>
      <p id="mengpo-result" style="margin-top:1rem; font-weight:bold; text-align:center;"></p>
      <div style="margin-top:1rem;">
        <h4>æ¶ˆé™¤è®°å¿†è®°å½•</h4>
        <button class="button button-danger" onclick="clearLostMemories()">æ¸…ç©ºè®°å¿†è®°å½•</button>
        <table class="transaction-table">
          <thead>
            <tr>
              <th>åºå·</th>
              <th>è®°å¿†</th>
              <th>æ—¶é—´</th>
              <th>æ“ä½œ</th>
            </tr>
          </thead>
          <tbody id="lost-memories-body"></tbody>
        </table>
      </div>
    </div>
    <!-- é˜ç‹ç•Œé¢ -->
    <div id="yanwang-dashboard" class="divine-section">
      <h3 class="divine-header">é˜ç‹ - ç”Ÿæ­»ç®¡ç†</h3>
      <div style="margin-bottom: 1rem;">
        <input type="text" id="yanwang-name" class="input-field" placeholder="è¯·è¾“å…¥å§“å">
        <select id="yanwang-fate" class="input-field">
          <option value="ç”Ÿ">ç”Ÿ</option>
          <option value="æ­»">æ­»</option>
        </select>
        <input type="text" id="yanwang-time" class="input-field" placeholder="è¯·è¾“å…¥ç”Ÿæ­»æ—¶é—´">
        <input type="text" id="yanwang-remarks" class="input-field" placeholder="è¯·è¾“å…¥å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰">
        <button class="button button-primary" onclick="addYanwangRecord()">æ·»åŠ è®°å½•</button>
      </div>
      <!-- æœç´¢/è¿‡æ»¤æ§ä»¶ -->
      <div style="margin-bottom: 1rem;">
        <input type="text" id="yanwang-search" class="input-field" placeholder="æœç´¢å§“å">
        <select id="yanwang-filter" class="input-field">
          <option value="å…¨éƒ¨">å…¨éƒ¨</option>
          <option value="ç”Ÿ">ç”Ÿ</option>
          <option value="æ­»">æ­»</option>
        </select>
        <button class="button button-primary" onclick="renderYanwangRegister()">æœç´¢</button>
      </div>
      <table class="transaction-table">
        <thead>
          <tr>
            <th>åºå·</th>
            <th>å§“å</th>
            <th>çŠ¶æ€</th>
            <th>æ—¶é—´</th>
            <th>å¤‡æ³¨</th>
            <th>æ“ä½œ</th>
          </tr>
        </thead>
        <tbody id="yanwang-register-body"></tbody>
      </table>
    </div>
  </div>



  <!-- å……å€¼å¼¹çª— -->
  <div id="recharge-modal" class="modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal('recharge-modal')">&times;</button>
      <h3>ğŸ’° è´¦æˆ·å……å€¼</h3>
      <div class="input-group">
        <input type="number" class="input-field" id="recharge-amount" placeholder="è¯·è¾“å…¥å……å€¼é‡‘é¢" min="0">
      </div>
      <div class="input-group">
        <input type="password" class="input-field" id="recharge-password" placeholder="è¯·è¾“å…¥å®‰å…¨å¯†ç ">
      </div>
      <button class="button button-success" onclick="processRecharge()">ç¡®è®¤å……å€¼</button>
    </div>
  </div>

  <!-- æ”¯ä»˜å¼¹çª— -->
  <div id="payment-modal" class="modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal('payment-modal')">&times;</button>
      <h3>ğŸ’³ å‘èµ·æ”¯ä»˜</h3>
      <div class="input-group">
        <input type="text" class="input-field" id="payment-card" placeholder="æ”¶æ¬¾æ–¹é“¶è¡Œå¡å·">
      </div>
      <div class="input-group">
        <input type="number" class="input-field" id="payment-amount" placeholder="æ”¯ä»˜é‡‘é¢" min="0">
      </div>
      <div class="input-group">
        <input type="password" class="input-field" id="payment-password" placeholder="å®‰å…¨å¯†ç ">
      </div>
      <button class="button button-primary" onclick="processPayment()">ç¡®è®¤æ”¯ä»˜</button>
    </div>
  </div>

  <!-- è½¬è´¦å¼¹çª— -->
  <div id="transfer-modal" class="modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal('transfer-modal')">&times;</button>
      <h3>â†”ï¸ è´¦æˆ·è½¬è´¦</h3>
      <div class="input-group">
        <input type="text" class="input-field" id="transfer-card" placeholder="æ”¶æ¬¾æ–¹é“¶è¡Œå¡å·">
      </div>
      <div class="input-group">
        <input type="number" class="input-field" id="transfer-amount" placeholder="è½¬è´¦é‡‘é¢" min="0">
      </div>
      <div class="input-group">
        <input type="password" class="input-field" id="transfer-password" placeholder="å®‰å…¨å¯†ç ">
      </div>
      <button class="button button-primary" onclick="processTransfer()">ç¡®è®¤è½¬è´¦</button>
    </div>
  </div>

  <!-- ä¸‰ç•Œè½¬è´¦å¼¹çª— -->
  <div id="three-realm-modal" class="modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal('three-realm-modal')">&times;</button>
      <h3>ğŸŒŒ ä¸‰ç•Œè½¬è´¦</h3>
      <div class="input-group">
        <label class="input-label" for="three-realm-target">è½¬å…¥ç•ŒåŸŸ</label>
        <select class="input-field" id="three-realm-target">
          <option value="å¤©ç•Œ">å¤©ç•Œ</option>
          <option value="äººé—´">äººé—´</option>
          <option value="å†¥ç•Œ">å†¥ç•Œ</option>
        </select>
      </div>
      <div class="input-group">
        <input type="number" class="input-field" id="three-realm-amount" placeholder="è¯·è¾“å…¥è½¬è´¦é‡‘é¢" min="0">
      </div>
      <div class="input-group">
        <input type="password" class="input-field" id="three-realm-password" placeholder="è¯·è¾“å…¥å®‰å…¨å¯†ç ">
      </div>
      <button class="button button-warning" onclick="processThreeRealmTransfer()">ç¡®è®¤è½¬è´¦</button>
    </div>
  </div>

  <!-- è·¨ä¸–è½¬è´¦å¼¹çª— -->
  <div id="next-life-modal" class="modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal('next-life-modal')">&times;</button>
      <h3>ğŸ”® è·¨ä¸–è½¬è´¦</h3>
      <div class="input-group">
        <input type="number" class="input-field" id="next-life-amount" placeholder="è¯·è¾“å…¥è½¬è´¦é‡‘é¢" min="0">
      </div>
      <div class="input-group">
        <input type="password" class="input-field" id="next-life-password" placeholder="è¯·è¾“å…¥å®‰å…¨å¯†ç ">
      </div>
      <button class="button button-danger" onclick="processNextLifeTransfer()">ç¡®è®¤è½¬è´¦</button>
    </div>
  </div>

  <!-- å…­é“è½®å›æŸ¥è¯¢å¼¹çª— -->
  <div id="six-path-modal" class="modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal('six-path-modal')">&times;</button>
      <h3>â™¾ï¸ å…­é“è½®å›æŸ¥è¯¢</h3>
      <p id="six-path-result" style="margin-bottom:1rem; font-weight:bold; text-align:center;"></p>
      <button class="button button-primary" onclick="processSixPathQuery()">æŸ¥è¯¢</button>
    </div>
  </div>

  <!-- å¤©å‘½æŠ½ç­¾å¼¹çª— -->
  <div id="divination-modal" class="modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal('divination-modal')">&times;</button>
      <h3>ğŸ”® å¤©å‘½æŠ½ç­¾</h3>
      <p style="font-size:0.9rem; margin-bottom:1rem;">ï¼ˆæŠ½ç­¾éœ€é¢„æ‰£æœ€ä½ $12 ä»¥é˜²å‡¶ç­¾æ‰£æ¬¾ï¼‰</p>
      <button class="button button-warning" onclick="processDivination()">æŠ½ç­¾</button>
      <p id="divination-result" style="margin-top:1rem; font-weight:bold; text-align:center;"></p>
    </div>
  </div>

  <!-- ç¬¦ç®“è´­ä¹°å¼¹çª— -->
  <div id="talisman-modal" class="modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal('talisman-modal')">&times;</button>
      <h3>ğŸ€„ ç¬¦ç®“è´­ä¹°</h3>
      <div class="input-group">
        <label class="input-label" for="talisman-type">è¯·é€‰æ‹©ç¬¦ç®“ç±»å‹</label>
        <select class="input-field" id="talisman-type">
          <option value="30">å¹³å®‰ç¬¦ ($30)</option>
          <option value="40">è¾Ÿé‚ªç¬¦ ($40)</option>
          <option value="50">æ±‚è´¢ç¬¦ ($50)</option>
          <option value="35">æ±‚å¥åº·ç¬¦ ($35)</option>
        </select>
      </div>
      <div class="input-group">
        <input type="password" class="input-field" id="talisman-password" placeholder="è¯·è¾“å…¥å®‰å…¨å¯†ç ">
      </div>
      <button class="button button-info" onclick="processTalismanPurchase()">ç¡®è®¤è´­ä¹°</button>
    </div>
  </div>

  <!-- ä¸¹è¯ç‚¼åˆ¶å¼¹çª— -->
  <div id="pill-modal" class="modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal('pill-modal')">&times;</button>
      <h3>âš—ï¸ ä¸¹è¯ç‚¼åˆ¶</h3>
      <div class="input-group">
        <input type="number" class="input-field" id="pill-amount" placeholder="è¯·è¾“å…¥ç‚¼ä¸¹æŠ•å…¥é‡‘é¢" min="0">
      </div>
      <div class="input-group">
        <input type="password" class="input-field" id="pill-password" placeholder="è¯·è¾“å…¥å®‰å…¨å¯†ç ">
      </div>
      <button class="button button-danger" onclick="processPillRefinement()">ç‚¼åˆ¶ä¸¹è¯</button>
    </div>
  </div>


  <div id="offering-modal" class="modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal('offering-modal')">&times;</button>
      <h3>ğŸ™ ä¾›ä½›</h3>
      <div class="input-group">
        <label class="input-label" for="offering-deity">è¯·é€‰æ‹©ä¾›ä½›å¯¹è±¡</label>
        <select class="input-field" id="offering-deity">
          <option value="é‡Šè¿¦ç‰Ÿå°¼ä½›">é‡Šè¿¦ç‰Ÿå°¼ä½›</option>
          <option value="è§‚éŸ³è©è¨">è§‚éŸ³è©è¨</option>
          <option value="æ–‡æ®Šè©è¨">æ–‡æ®Šè©è¨</option>
          <option value="æ™®è´¤è©è¨">æ™®è´¤è©è¨</option>
          <option value="åœ°è—ç‹è©è¨">åœ°è—ç‹è©è¨</option>
        </select>
      </div>
      <div class="input-group">
        <label class="input-label" for="offering-method">è¯·é€‰æ‹©ä¾›å…»æ–¹å¼</label>
        <select class="input-field" id="offering-method">
          <option value="ä¾›èŠ±">ä¾›èŠ±</option>
          <option value="ä¾›ç¯">ä¾›ç¯</option>
          <option value="ä¾›æ–‹">ä¾›æ–‹</option>
          <option value="ä¾›é¦™">ä¾›é¦™</option>
        </select>
      </div>
      <div class="input-group">
        <input type="number" class="input-field" id="offering-amount" placeholder="è¯·è¾“å…¥ä¾›ä½›é‡‘é¢" min="0">
      </div>
      <div class="input-group">
        <input type="password" class="input-field" id="offering-password" placeholder="è¯·è¾“å…¥å®‰å…¨å¯†ç ">
      </div>
      <button class="button button-success" onclick="processOffering()">ç¡®è®¤ä¾›ä½›</button>
    </div>
  </div>

  <!-- è¯µç»è®¡æ—¶å¼¹çª—ï¼ˆé‡‡ç”¨å¼€å§‹/æš‚åœåˆ‡æ¢ï¼‰ -->
  <div id="chanting-modal" class="modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal('chanting-modal')">&times;</button>
      <h3>ğŸ“¿ ç»å…¸è¯µç»</h3>
      <p>ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹è¯µç»ï¼Œæ¯10ç§’è‡ªåŠ¨å¢åŠ 5åŠŸå¾·ï¼Œç›´è‡³æ‰‹åŠ¨æš‚åœã€‚</p>
      <button class="button button-info" id="toggle-chanting" onclick="toggleChanting()">å¼€å§‹è¯µç»</button>
      <p id="chanting-result" style="margin-top:1rem; font-weight:bold; text-align:center;"></p>
    </div>
  </div>

  <!-- æˆ‘çš„å•†å“å¼¹çª— -->
  <div id="my-goods-modal" class="modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal('my-goods-modal')">&times;</button>
      <h3>ğŸ›ï¸ æˆ‘çš„å•†å“</h3>
      <table class="transaction-table">
        <thead>
          <tr>
            <th>æ—¶é—´</th>
            <th>å•†å“åç§°</th>
            <th>ä»·æ ¼</th>
          </tr>
        </thead>
        <tbody id="goods-body"></tbody>
      </table>
      <button class="button button-primary" onclick="closeModal('my-goods-modal')">å…³é—­</button>
    </div>
  </div>

  <!-- åŠ è½½åŠ¨ç”» -->
  <div class="loading-overlay" id="loading">
    <div class="loading-spinner"></div>
  </div>

  <script>
    // å…¨å±€æ•°æ®ï¼šä½™é¢ã€äº¤æ˜“è®°å½•ã€å·²è´­å•†å“ã€åŠŸå¾·å€¼
    let currentUser = null;
    let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
    let balance = parseFloat(localStorage.getItem('balance')) || 0;
    let purchasedItems = JSON.parse(localStorage.getItem('purchasedItems')) || [];
    let merit = parseFloat(localStorage.getItem('merit')) || 0;
    let chantingInterval = null; // è¯µç»å®šæ—¶å™¨
    let currentDivineRole = null; // å½“å‰ç¥èŒäººå‘˜è§’è‰²
    let lifeDeathRegister = []; // é…†éƒ½å¤§å¸ç”Ÿæ­»ç°¿æ•°æ®
    let yanwangRegister = [];   // é˜ç‹æ‰‹åŠ¨ç®¡ç†çš„ç”Ÿæ­»è®°å½•
    let heibaiHistory = [];      // é»‘ç™½æ— å¸¸æŠ“æ•å†å²
    let lostMemories = [];       // å­Ÿå©†è®°å½•çš„æ¶ˆé™¤è®°å¿†

    // ç¥èŒäººå‘˜é»˜è®¤å¯†ç 
    const divineCredentials = {
      "é…†éƒ½å¤§å¸": "fengdu",
      "é»‘ç™½æ— å¸¸": "heibai",
      "å­Ÿå©†": "mengpo",
      "é˜ç‹": "yanwang"
    };

    window.onload = () => {
      updateBalanceDisplay();
      renderTransactions();
      renderPurchasedItems();
    };

    // ç”¨æˆ·ç™»å½•
    function login() {
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      if (username.trim() === "" || password.trim() === "") {
        alert('è¯·è¾“å…¥æœ‰æ•ˆçš„ç”¨æˆ·åå’Œå¯†ç ');
        return;
      }
      currentUser = { username, password };
      document.getElementById('login-page').style.display = 'none';
      document.getElementById('wallet-page').style.display = 'block';
    }

    // ç”¨æˆ·ç™»å‡º
    function logout() {
      currentUser = null;
      document.getElementById('wallet-page').style.display = 'none';
      document.getElementById('login-page').style.display = 'block';
    }

    // ç¥èŒäººå‘˜ç™»å½•
    function divineLogin() {
      const roleSelect = document.getElementById('divine-role');
      const role = roleSelect.value;
      const password = document.getElementById('divine-password').value;
      if (password !== divineCredentials[role]) {
        alert('å¯†ç é”™è¯¯');
        return;
      }
      currentDivineRole = role;
      document.getElementById('divine-login-page').style.display = 'none';
      document.getElementById('divine-dashboard').style.display = 'block';
      renderDivineDashboard();
    }

    // ç¥èŒäººå‘˜ç™»å‡º
    function divineLogout() {
      currentDivineRole = null;
      document.getElementById('divine-dashboard').style.display = 'none';
      document.getElementById('divine-login-page').style.display = 'block';
    }

    // ç¥èŒäººå‘˜åŠŸèƒ½ç•Œé¢æ¸²æŸ“
    function renderDivineDashboard() {
      // éšè—æ‰€æœ‰å­ç•Œé¢
      document.getElementById('fengdu-dashboard').style.display = 'none';
      document.getElementById('heibai-dashboard').style.display = 'none';
      document.getElementById('mengpo-dashboard').style.display = 'none';
      document.getElementById('yanwang-dashboard').style.display = 'none';
      if (currentDivineRole === "é…†éƒ½å¤§å¸") {
        document.getElementById('fengdu-dashboard').style.display = 'block';
        refreshLifeDeathRegister();
      } else if (currentDivineRole === "é»‘ç™½æ— å¸¸") {
        document.getElementById('heibai-dashboard').style.display = 'block';
        renderHeibaiHistory();
      } else if (currentDivineRole === "å­Ÿå©†") {
        document.getElementById('mengpo-dashboard').style.display = 'block';
        renderLostMemories();
      } else if (currentDivineRole === "é˜ç‹") {
        document.getElementById('yanwang-dashboard').style.display = 'block';
        renderYanwangRegister();
      }
    }

    // æ›´æ–°æœ¬åœ°å­˜å‚¨åŠæ˜¾ç¤º
    function updateStorage() {
      localStorage.setItem('balance', balance);
      localStorage.setItem('transactions', JSON.stringify(transactions));
      localStorage.setItem('purchasedItems', JSON.stringify(purchasedItems));
      localStorage.setItem('merit', merit);
      updateBalanceDisplay();
      renderTransactions();
      renderPurchasedItems();
    }

    function updateBalanceDisplay() {
      document.getElementById('balance-amount').textContent = `$${balance.toFixed(2)}`;
      document.getElementById('merit-value').textContent = merit.toFixed(2);
    }

    function addTransaction(type, amount, balanceAfter) {
      const transaction = {
        date: new Date().toLocaleString(),
        type: type,
        amount: amount.toFixed(2),
        balance: balanceAfter.toFixed(2)
      };
      transactions.push(transaction);
    }

    function renderTransactions() {
      const tbody = document.getElementById('transaction-body');
      tbody.innerHTML = transactions.map((t, index) => `
        <tr>
          <td>${t.date}</td>
          <td>${t.type}</td>
          <td>${t.amount}</td>
          <td>${t.balance}</td>
          <td><button class="button button-danger" onclick="deleteTransaction(${index})">åˆ é™¤</button></td>
        </tr>
      `).join('');
    }

    // åˆ é™¤å•ä¸ªäº¤æ˜“è®°å½•
    function deleteTransaction(index) {
      if (confirm("ç¡®å®šè¦åˆ é™¤æ­¤äº¤æ˜“è®°å½•å—ï¼Ÿ")) {
        transactions.splice(index, 1);
        updateStorage();
      }
    }

    function toggleTransactions() {
      const container = document.getElementById('transactions-container');
      container.style.display = (container.style.display === 'none') ? 'block' : 'none';
    }

    function clearTransactions() {
      if (confirm("ç¡®å®šè¦åˆ é™¤æ‰€æœ‰äº¤æ˜“è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚")) {
        transactions = [];
        updateStorage();
        alert("äº¤æ˜“è®°å½•å·²æ¸…ç©ºã€‚");
      }
    }

    function renderPurchasedItems() {
      const tbody = document.getElementById('goods-body');
      tbody.innerHTML = purchasedItems.map(item => `
        <tr>
          <td>${item.date}</td>
          <td>${item.name}</td>
          <td>$${parseFloat(item.price).toFixed(2)}</td>
        </tr>
      `).join('');
    }

    function showLoading() {
      document.getElementById('loading').style.display = 'flex';
    }

    function hideLoading() {
      document.getElementById('loading').style.display = 'none';
    }

    // å¤„ç†å……å€¼
    function processRecharge() {
      const amount = parseFloat(document.getElementById('recharge-amount').value);
      const password = document.getElementById('recharge-password').value;
      if (!validateInput(amount, password)) return;
      showLoading();
      setTimeout(() => {
        balance += amount;
        addTransaction('å……å€¼', amount, balance);
        updateStorage();
        closeModal('recharge-modal');
        hideLoading();
        alert(`æˆåŠŸå……å€¼ $${amount.toFixed(2)}`);
      }, 1500);
    }

    // å¤„ç†æ”¯ä»˜
    function processPayment() {
      const amount = parseFloat(document.getElementById('payment-amount').value);
      const password = document.getElementById('payment-password').value;
      if (!validateInput(amount, password)) return;
      if (!checkBalance(amount)) return;
      showLoading();
      setTimeout(() => {
        balance -= amount;
        addTransaction('æ”¯ä»˜', -amount, balance);
        updateStorage();
        closeModal('payment-modal');
        hideLoading();
        alert(`æ”¯ä»˜æˆåŠŸ $${amount.toFixed(2)}`);
      }, 1500);
    }

    // å¤„ç†è½¬è´¦
    function processTransfer() {
      const amount = parseFloat(document.getElementById('transfer-amount').value);
      const password = document.getElementById('transfer-password').value;
      if (!validateInput(amount, password)) return;
      if (!checkBalance(amount)) return;
      showLoading();
      setTimeout(() => {
        balance -= amount;
        addTransaction('è½¬è´¦', -amount, balance);
        updateStorage();
        closeModal('transfer-modal');
        hideLoading();
        alert(`æˆåŠŸè½¬è´¦ $${amount.toFixed(2)}`);
      }, 1500);
    }

    // å¤„ç†ä¸‰ç•Œè½¬è´¦ï¼ˆå«2%æ‰‹ç»­è´¹ï¼‰
    function processThreeRealmTransfer() {
      const amount = parseFloat(document.getElementById('three-realm-amount').value);
      const password = document.getElementById('three-realm-password').value;
      const targetRealm = document.getElementById('three-realm-target').value;
      if (!validateInput(amount, password)) return;
      const fee = amount * 0.02;
      const totalDeduction = amount + fee;
      if (!checkBalance(totalDeduction)) return;
      showLoading();
      setTimeout(() => {
        balance -= totalDeduction;
        addTransaction(`ä¸‰ç•Œè½¬è´¦è‡³ ${targetRealm} (æ‰‹ç»­è´¹: $${fee.toFixed(2)})`, -totalDeduction, balance);
        updateStorage();
        closeModal('three-realm-modal');
        hideLoading();
        alert(`æˆåŠŸè½¬è´¦ $${amount.toFixed(2)} è‡³ ${targetRealm} ï¼ˆæ‰‹ç»­è´¹ $${fee.toFixed(2)}ï¼‰`);
      }, 1500);
    }

    // å¤„ç†è·¨ä¸–è½¬è´¦
    function processNextLifeTransfer() {
      const amount = parseFloat(document.getElementById('next-life-amount').value);
      const password = document.getElementById('next-life-password').value;
      if (!validateInput(amount, password)) return;
      if (!checkBalance(amount)) return;
      showLoading();
      setTimeout(() => {
        balance -= amount;
        addTransaction('è·¨ä¸–è½¬è´¦ï¼ˆç»™æœªæ¥çš„è‡ªå·±ï¼‰', -amount, balance);
        updateStorage();
        closeModal('next-life-modal');
        hideLoading();
        alert(`æˆåŠŸè·¨ä¸–è½¬è´¦ $${amount.toFixed(2)}`);
      }, 1500);
    }

    // å¤„ç†å…­é“è½®å›æŸ¥è¯¢ï¼ˆæ— é‡‘é¢å˜åŠ¨ï¼‰
    function processSixPathQuery() {
      const paths = ["å¤©é“", "äººé“", "ä¿®ç½—é“", "ç•œç”Ÿé“", "é¥¿é¬¼é“", "åœ°ç‹±é“"];
      const result = paths[Math.floor(Math.random() * paths.length)];
      document.getElementById('six-path-result').textContent = `æ‚¨çš„è½®å›å½’å®¿ï¼š${result}`;
      addTransaction('å…­é“è½®å›æŸ¥è¯¢', 0, balance);
      updateStorage();
    }

    // å¤„ç†å¤©å‘½æŠ½ç­¾ï¼ˆé¢„æ‰£ $2 è´¹ç”¨ï¼Œæ ¹æ®ç­¾æ–‡å¥–åŠ±æˆ–æ‰£æ¬¾ï¼‰
    function processDivination() {
      if (balance < 12) {
        alert('ä½™é¢ä¸è¶³ï¼Œæ— æ³•æŠ½ç­¾ï¼ˆè‡³å°‘éœ€è¦ $12ï¼‰');
        return;
      }
      showLoading();
      setTimeout(() => {
        balance -= 2;
        const fortunes = ["å¤§å‰", "ä¸­å‰", "å°å‰", "å‡¶", "å¤§å‡¶"];
        const fortune = fortunes[Math.floor(Math.random() * fortunes.length)];
        let net = 0;
        if (fortune === "å¤§å‰") {
          balance += 20;
          net = 20 - 2;
        } else if (fortune === "ä¸­å‰") {
          balance += 10;
          net = 10 - 2;
        } else if (fortune === "å°å‰") {
          balance += 5;
          net = 5 - 2;
        } else if (fortune === "å‡¶") {
          if (!checkBalance(5)) { hideLoading(); alert('ä½™é¢ä¸è¶³ï¼Œæ— æ³•æ‰£æ¬¾'); return; }
          balance -= 5;
          net = -7;
        } else if (fortune === "å¤§å‡¶") {
          if (!checkBalance(10)) { hideLoading(); alert('ä½™é¢ä¸è¶³ï¼Œæ— æ³•æ‰£æ¬¾'); return; }
          balance -= 10;
          net = -12;
        }
        addTransaction(`å¤©å‘½æŠ½ç­¾: ${fortune}`, net, balance);
        updateStorage();
        closeModal('divination-modal');
        hideLoading();
        alert(`æ‚¨çš„ç­¾æ–‡ä¸ºã€${fortune}ã€‘\næœ¬æ¬¡å‡€${net >= 0 ? "è·åˆ©" : "äºæŸ"} $${Math.abs(net).toFixed(2)}`);
      }, 1500);
    }

    // å¤„ç†ç¬¦ç®“è´­ä¹°
    function processTalismanPurchase() {
      const select = document.getElementById('talisman-type');
      const password = document.getElementById('talisman-password').value;
      if (!currentUser || password !== currentUser.password) {
        alert('å®‰å…¨å¯†ç é”™è¯¯');
        return;
      }
      const price = parseFloat(select.value);
      const talismanType = select.options[select.selectedIndex].text;
      if (!checkBalance(price)) return;
      showLoading();
      setTimeout(() => {
        balance -= price;
        addTransaction(`è´­ä¹°ç¬¦ç®“ï¼š${talismanType}`, -price, balance);
        purchasedItems.push({ date: new Date().toLocaleString(), name: talismanType, price });
        updateStorage();
        closeModal('talisman-modal');
        hideLoading();
        alert(`æˆåŠŸè´­ä¹° ${talismanType}ï¼Œæ„¿é“æ³•æŠ¤ä½‘`);
      }, 1500);
    }

    // å¤„ç†ä¸¹è¯ç‚¼åˆ¶
    function processPillRefinement() {
      const amount = parseFloat(document.getElementById('pill-amount').value);
      const password = document.getElementById('pill-password').value;
      if (!validateInput(amount, password)) return;
      if (!checkBalance(amount)) return;
      showLoading();
      setTimeout(() => {
        balance -= amount;
        let pillType = "";
        let refundMultiplier = 0;
        if (amount < 20) {
          pillType = "æ™®é€šæ•£ä¸¹";
          refundMultiplier = 0;
        } else if (amount < 50) {
          pillType = "å‡å…ƒä¸¹";
          refundMultiplier = 0.1;
        } else if (amount < 100) {
          pillType = "é‡‘ä¸¹";
          refundMultiplier = 0.25;
        } else {
          pillType = "å¤ªä¹™ä¸¹";
          refundMultiplier = 0.5;
        }
        const refund = amount * refundMultiplier;
        balance += refund;
        const net = refund - amount;
        addTransaction(`ç‚¼åˆ¶ä¸¹è¯ï¼š${pillType}`, net, balance);
        purchasedItems.push({ date: new Date().toLocaleString(), name: `ç‚¼åˆ¶å‡ºã€${pillType}ã€‘`, price: refund.toFixed(2) });
        updateStorage();
        closeModal('pill-modal');
        hideLoading();
        alert(`ä¸¹è¯ç‚¼åˆ¶ç»“æœï¼šç‚¼åˆ¶å‡ºã€${pillType}ã€‘\næœ¬æ¬¡å‡€${net >= 0 ? "è·åˆ©" : "äºæŸ"} $${Math.abs(net).toFixed(2)}`);
      }, 1500);
    }


    function processOffering() {
      const deity = document.getElementById('offering-deity').value;
      const method = document.getElementById('offering-method').value;
      const amount = parseFloat(document.getElementById('offering-amount').value);
      const password = document.getElementById('offering-password').value;
      if (!validateInput(amount, password)) return;
      if (!checkBalance(amount)) return;
      showLoading();
      setTimeout(() => {
        balance -= amount;
        let multiplier = 1;
        if(method === "ä¾›èŠ±") {
          multiplier = 1.0;
        } else if(method === "ä¾›ç¯") {
          multiplier = 1.2;
        } else if(method === "ä¾›æ–‹") {
          multiplier = 1.5;
        } else if(method === "ä¾›é¦™") {
          multiplier = 0.8;
        }
        const addedMerit = amount * multiplier;
        merit += addedMerit;
        addTransaction(`ä¾›ä½›ï¼š${deity} - ${method}`, -amount, balance);
        updateStorage();
        closeModal('offering-modal');
        hideLoading();
        alert(`ä¾›ä½›æˆåŠŸï¼ä¾›å…» ${deity}ï¼ˆ${method}ï¼‰ï¼Œæ‰£æ¬¾ $${amount.toFixed(2)}ï¼ŒåŠŸå¾·å¢åŠ  ${addedMerit.toFixed(2)}`);
      }, 1500);
    }

    // è¯µç»è®¡æ—¶ï¼ˆå¼€å§‹/æš‚åœåˆ‡æ¢ï¼‰
    function toggleChanting() {
      const btn = document.getElementById('toggle-chanting');
      if (chantingInterval === null) {
        // å¼€å§‹è¯µç»
        btn.textContent = "æš‚åœè¯µç»";
        document.getElementById('chanting-result').textContent = "è¯µç»ä¸­â€¦â€¦";
        chantingInterval = setInterval(() => {
          const addedMerit = 5;
          merit += addedMerit;
          updateStorage();
          document.getElementById('chanting-result').textContent = `è¯µç»ä¸­â€¦â€¦å·²å¢åŠ åŠŸå¾· ${addedMerit}ï¼ˆç´¯è®¡åŠŸå¾· ${merit.toFixed(2)}ï¼‰`;
        }, 10000);
      } else {
        // æš‚åœè¯µç»
        clearInterval(chantingInterval);
        chantingInterval = null;
        btn.textContent = "å¼€å§‹è¯µç»";
        document.getElementById('chanting-result').textContent = "è¯µç»å·²æš‚åœ";
      }
    }

    // å¼¹çª—æ§åˆ¶
    function closeModal(modalId) {
      document.getElementById(modalId).style.display = 'none';
      clearInputs(modalId);
      if(modalId === 'six-path-modal'){
        document.getElementById('six-path-result').textContent = "";
      }
      if(modalId === 'divination-modal'){
        document.getElementById('divination-result').textContent = "";
      }
      if(modalId === 'chanting-modal'){
        if (chantingInterval !== null) {
          clearInterval(chantingInterval);
          chantingInterval = null;
        }
        document.getElementById('toggle-chanting').textContent = "å¼€å§‹è¯µç»";
        document.getElementById('chanting-result').textContent = "";
      }
    }

    function openModal(modalId) {
      document.getElementById(modalId).style.display = 'flex';
    }

    function clearInputs(modalId) {
      const inputs = document.querySelectorAll(`#${modalId} .input-field`);
      inputs.forEach(input => input.value = '');
    }

    // é€šç”¨éªŒè¯ï¼šå®‰å…¨å¯†ç å¿…é¡»ä¸ç™»å½•æ—¶ä¸€è‡´ï¼›é‡‘é¢å¿…é¡»ä¸ºæ­£
    function validateInput(amount, password) {
      if (!currentUser || password !== currentUser.password) {
        alert('å®‰å…¨å¯†ç é”™è¯¯');
        return false;
      }
      if (isNaN(amount) || amount <= 0) {
        alert('è¯·è¾“å…¥æœ‰æ•ˆçš„é‡‘é¢');
        return false;
      }
      return true;
    }

    // ä½™é¢æ£€æŸ¥
    function checkBalance(amount) {
      if (amount > balance) {
        alert('ä½™é¢ä¸è¶³');
        return false;
      }
      return true;
    }

    /* === é…†éƒ½å¤§å¸ç›¸å…³åŠŸèƒ½ === */
    function refreshLifeDeathRegister() {
      const names = ["å¼ ä¸‰", "æå››", "ç‹äº”", "èµµå…­", "å­™ä¸ƒ"];
      lifeDeathRegister = [];
      for (let i = 0; i < 5; i++) {
        const name = names[Math.floor(Math.random() * names.length)];
        const fate = Math.random() > 0.5 ? "ç”Ÿ" : "æ­»";
        const time = new Date().toLocaleString();
        lifeDeathRegister.push({ index: i+1, name, fate, time });
      }
      renderLifeDeathRegister();
      updateFengduStats();
    }

    function renderLifeDeathRegister() {
      const tbody = document.getElementById('life-death-body');
      tbody.innerHTML = lifeDeathRegister.map(entry => `
        <tr>
          <td>${entry.index}</td>
          <td>${entry.name}</td>
          <td>${entry.fate}</td>
          <td>${entry.time}</td>
        </tr>
      `).join('');
    }

    function updateFengduStats() {
      const countSheng = lifeDeathRegister.filter(r => r.fate === "ç”Ÿ").length;
      const countSi = lifeDeathRegister.filter(r => r.fate === "æ­»").length;
      document.getElementById('fengdu-stats').innerHTML = `<p>ç»Ÿè®¡ï¼šç”Ÿï¼š${countSheng}ï¼Œæ­»ï¼š${countSi}</p>`;
    }

    function printLifeDeathRegister() {
      let content = "ç”Ÿæ­»ç°¿è¯¦æƒ…ï¼š\n";
      lifeDeathRegister.forEach(entry => {
        content += `åºå·ï¼š${entry.index}ï¼Œå§“åï¼š${entry.name}ï¼ŒçŠ¶æ€ï¼š${entry.fate}ï¼Œæ—¶é—´ï¼š${entry.time}\n`;
      });
      alert(content);
    }

    /* === é»‘ç™½æ— å¸¸ç›¸å…³åŠŸèƒ½ === */
    function catchPerson() {
      const names = ["èµµé’±å­™", "æå‘¨å´", "éƒ‘ç‹å†¯", "é™ˆè¤šå«", "è’‹æ²ˆéŸ©"];
      const person = names[Math.floor(Math.random() * names.length)];
      const now = new Date().toLocaleString();
      heibaiHistory.push({ name: person, time: now });
      renderHeibaiHistory();
      document.getElementById('heibai-result').textContent = `æŠ“åˆ°äº†ï¼š${person}`;
    }

    function renderHeibaiHistory() {
      const tbody = document.getElementById('heibai-history-body');
      tbody.innerHTML = heibaiHistory.map((record, idx) => `
        <tr>
          <td>${idx + 1}</td>
          <td>${record.name}</td>
          <td>${record.time}</td>
          <td><button class="button button-danger" onclick="deleteHeibaiHistory(${idx})">åˆ é™¤</button></td>
        </tr>
      `).join('');
    }

    function deleteHeibaiHistory(index) {
      if (confirm("ç¡®å®šåˆ é™¤æ­¤æŠ“æ•è®°å½•å—ï¼Ÿ")) {
        heibaiHistory.splice(index, 1);
        renderHeibaiHistory();
      }
    }

    function clearHeibaiHistory() {
      if (confirm("ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æŠ“æ•å†å²å—ï¼Ÿ")) {
        heibaiHistory = [];
        renderHeibaiHistory();
      }
    }

    /* === å­Ÿå©†ç›¸å…³åŠŸèƒ½ === */
    function serveMengPoSoup() {
      const memories = [
        "å‰ä¸–ä¸ºå¯Œè±ª",
        "å‰ä¸–ä¸ºè´«æ°‘",
        "å‰ä¸–ä¸ºä¹¦ç”Ÿ",
        "å‰ä¸–ä¸ºæ­¦å°†",
        "å‰ä¸–ä¸ºè‰ºäºº"
      ];
      const memory = memories[Math.floor(Math.random() * memories.length)];
      const now = new Date().toLocaleString();
      lostMemories.push({ memory, time: now });
      renderLostMemories();
      document.getElementById('mengpo-result').textContent = "å­Ÿå©†æ±¤å·²å€’å‡ºï¼Œæ‰€æœ‰å‰ç”Ÿè®°å¿†å‡å·²æ¶ˆé™¤ã€‚";
    }

    function renderLostMemories() {
      const tbody = document.getElementById('lost-memories-body');
      tbody.innerHTML = lostMemories.map((entry, idx) => `
        <tr>
          <td>${idx + 1}</td>
          <td>${entry.memory}</td>
          <td>${entry.time}</td>
          <td><button class="button button-danger" onclick="deleteLostMemory(${idx})">åˆ é™¤</button></td>
        </tr>
      `).join('');
    }

    function deleteLostMemory(index) {
      if (confirm("ç¡®å®šåˆ é™¤æ­¤è®°å¿†è®°å½•å—ï¼Ÿ")) {
        lostMemories.splice(index, 1);
        renderLostMemories();
      }
    }

    function clearLostMemories() {
      if (confirm("ç¡®å®šæ¸…ç©ºæ‰€æœ‰è®°å¿†è®°å½•å—ï¼Ÿ")) {
        lostMemories = [];
        renderLostMemories();
      }
    }

    /* === é˜ç‹ç›¸å…³åŠŸèƒ½ === */
    function addYanwangRecord() {
      const name = document.getElementById('yanwang-name').value.trim();
      const fate = document.getElementById('yanwang-fate').value;
      const time = document.getElementById('yanwang-time').value.trim();
      const remarks = document.getElementById('yanwang-remarks').value.trim();
      if (name === "" || time === "") {
        alert("è¯·è¾“å…¥å®Œæ•´çš„å§“åå’Œç”Ÿæ­»æ—¶é—´");
        return;
      }
      const record = {
        index: yanwangRegister.length + 1,
        name,
        fate,
        time,
        remarks
      };
      yanwangRegister.push(record);
      renderYanwangRegister();
      // æ¸…ç©ºè¾“å…¥æ¡†
      document.getElementById('yanwang-name').value = "";
      document.getElementById('yanwang-time').value = "";
      document.getElementById('yanwang-remarks').value = "";
    }

    function renderYanwangRegister() {
      // è·å–æœç´¢å…³é”®å­—å’Œè¿‡æ»¤æ¡ä»¶
      const search = document.getElementById('yanwang-search').value.trim().toLowerCase();
      const filter = document.getElementById('yanwang-filter').value;
      let records = yanwangRegister;
      if (search !== "") {
        records = records.filter(rec => rec.name.toLowerCase().includes(search));
      }
      if (filter !== "å…¨éƒ¨") {
        records = records.filter(rec => rec.fate === filter);
      }
      const tbody = document.getElementById('yanwang-register-body');
      tbody.innerHTML = records.map((record, idx) => `
        <tr>
          <td>${idx + 1}</td>
          <td>${record.name}</td>
          <td>${record.fate}</td>
          <td>${record.time}</td>
          <td>${record.remarks || ""}</td>
          <td>
            <button class="button button-primary" onclick="editYanwangRecord(${idx})">ç¼–è¾‘</button>
            <button class="button button-danger" onclick="deleteYanwangRecord(${idx})">åˆ é™¤</button>
          </td>
        </tr>
      `).join('');
    }

    function editYanwangRecord(index) {

      let record = yanwangRegister[index];
      const newName = prompt("ä¿®æ”¹å§“åï¼š", record.name);
      if (newName === null) return;
      const newFate = prompt("ä¿®æ”¹çŠ¶æ€ï¼ˆç”Ÿ/æ­»ï¼‰ï¼š", record.fate);
      if (newFate === null) return;
      const newTime = prompt("ä¿®æ”¹æ—¶é—´ï¼š", record.time);
      if (newTime === null) return;
      const newRemarks = prompt("ä¿®æ”¹å¤‡æ³¨ï¼š", record.remarks || "");
      if (newRemarks === null) return;
      yanwangRegister[index] = {
        index: record.index,
        name: newName,
        fate: newFate,
        time: newTime,
        remarks: newRemarks
      };
      renderYanwangRegister();
    }

    function deleteYanwangRecord(index) {
      if (confirm("ç¡®å®šè¦åˆ é™¤æ­¤è®°å½•å—ï¼Ÿ")) {
        yanwangRegister.splice(index, 1);
        renderYanwangRegister();
      }
    }
  </script>
</body>
</html>
